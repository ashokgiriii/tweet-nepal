<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tweet Nepal - Welcome</title>
    <link
      rel="shortcut icon"
      href="/favicon/android-chrome-192x192.png"
      type="image/x-icon"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
      :root {
        --primary: #e9a130;
        --primary-dark: #c98b28;
        --primary-light: #f3d19c;
        --background: #181a1b;
        --card-bg: #23272b;
        --card-bg-hover: #2a2f34;
        --border: #31363b;
        --input-bg: #1f2326;
        --input-border: #3a3f44;
        --input-border-focus: #e9a130;
        --white: #fff;
        --grey: #b0b3b8;
        --grey-light: #d1d5db;
        --grey-dark: #8a8d91;
        --success: #4caf50;
        --error: #ff4444;
        --error-light: rgba(255, 68, 68, 0.15);
        --shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
        --shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.25);
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        background: var(--background);
        font-family: "Inter", Arial, sans-serif;
        line-height: 1.6;
        color: var(--white);
      }

      #main {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 2rem;
        padding: 1.5rem;
      }

      .container {
        flex: 1 1 350px;
        max-width: 420px;
        transition: var(--transition);
        position: relative;
        z-index: 1;
      }

      .container:hover {
        transform: translateY(-8px);
        z-index: 10;
      }

      .form_area {
        background: var(--card-bg);
        border-radius: 20px;
        box-shadow: var(--shadow);
        padding: 2.5rem 2rem;
        width: 100%;
        margin-bottom: 0;
        border: 1px solid var(--border);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .form_area::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      }

      .container:hover .form_area {
        box-shadow: var(--shadow-hover);
        background: var(--card-bg-hover);
      }

      .title {
        font-weight: 900;
        font-size: 2.2rem;
        color: var(--primary);
        margin-bottom: 0.5rem;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .title i {
        font-size: 1.8rem;
      }

      .sub_title {
        font-weight: 500;
        color: var(--grey);
        margin-bottom: 1.8rem;
        font-size: 1.05rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
        position: relative;
      }

      .input-container {
        position: relative;
      }

      input.form_style {
        width: 100%;
        padding: 0.95rem 1rem 0.95rem 2.8rem;
        border-radius: 10px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--white);
        font-size: 1rem;
        transition: var(--transition);
        font-family: "Inter", sans-serif;
      }

      input.form_style:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(233, 161, 48, 0.2);
      }

      .input-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--grey-dark);
        font-size: 1.1rem;
        z-index: 2;
        transition: var(--transition);
      }

      input.form_style:focus + .input-icon {
        color: var(--primary);
      }

      .btn {
        width: 100%;
        padding: 1rem 0;
        font-size: 1.1rem;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: var(--white);
        font-weight: 700;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 0.5rem;
        transition: var(--transition);
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
      }

      .btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%);
        transform-origin: 50% 50%;
      }

      .btn:focus:not(:active)::after {
        animation: ripple 1s ease-out;
      }

      @keyframes ripple {
        0% {
          transform: scale(0, 0);
          opacity: 0.5;
        }
        20% {
          transform: scale(25, 25);
          opacity: 0.3;
        }
        100% {
          opacity: 0;
          transform: scale(40, 40);
        }
      }

      .btn:disabled {
        background: var(--primary-dark);
        cursor: not-allowed;
        opacity: 0.7;
      }

      .btn:hover:not(:disabled) {
        background: linear-gradient(135deg, var(--primary-dark), #b87a20);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      }

      .btn:active:not(:disabled) {
        transform: translateY(0);
      }

      .link {
        color: var(--primary);
        font-weight: 600;
        text-decoration: none;
        transition: var(--transition);
        display: inline-block;
        position: relative;
      }

      .link::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 2px;
        bottom: -2px;
        left: 0;
        background-color: var(--primary);
        transform: scaleX(0);
        transform-origin: bottom right;
        transition: transform 0.3s ease;
      }

      .link:hover {
        color: var(--primary-light);
      }

      .link:hover::after {
        transform: scaleX(1);
        transform-origin: bottom left;
      }

      .error-message {
        color: var(--error);
        font-size: 0.85rem;
        min-height: 1.2em;
        margin-top: 0.5rem;
        margin-bottom: 0;
        padding-left: 0.25rem;
        display: block;
        font-weight: 500;
        transition: var(--transition);
      }

      .error-message.hidden {
        opacity: 0;
        visibility: hidden;
        height: 0;
        margin: 0;
      }

      .usernameAvailable {
        font-size: 0.85rem;
        min-height: 1.2em;
        margin-top: 0.5rem;
        margin-bottom: 0;
        padding-left: 0.25rem;
        font-weight: 500;
        transition: var(--transition);
      }

      .usernameAvailable.available {
        color: var(--success);
      }

      .usernameAvailable.unavailable {
        color: var(--error);
      }

      input.form_style.error {
        border-color: var(--error);
        background: var(--error-light);
      }

      input.form_style.success {
        border-color: var(--success);
      }

      .password-strength {
        margin-top: 0.5rem;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .strength-bar {
        height: 4px;
        flex-grow: 1;
        background: var(--border);
        border-radius: 2px;
        overflow: hidden;
      }

      .strength-fill {
        height: 100%;
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 2px;
      }

      .strength-fill.weak {
        background: var(--error);
        width: 33%;
      }

      .strength-fill.medium {
        background: #ff9800;
        width: 66%;
      }

      .strength-fill.strong {
        background: var(--success);
        width: 100%;
      }

      .toggle-password {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        color: var(--grey-dark);
        cursor: pointer;
        font-size: 1.1rem;
        z-index: 3;
        transition: var(--transition);
      }

      .toggle-password:hover {
        color: var(--primary);
      }

      .logo-container {
        text-align: center;
        margin-bottom: 1.5rem;
        display: none;
      }

      .logo {
        color: var(--primary);
        font-size: 2.5rem;
        font-weight: 900;
        letter-spacing: 1px;
      }

      .logo span {
        color: var(--white);
      }

      .form-footer {
        text-align: center;
        margin-top: 1.5rem;
        color: var(--grey);
        font-size: 0.95rem;
      }

      /* Responsive styles */
      @media (max-width: 1024px) {
        #main {
          gap: 1.5rem;
        }
      }

      @media (max-width: 768px) {
        .container {
          flex: 1 1 100%;
          max-width: 450px;
        }

        .container:hover {
          transform: translateY(-5px);
        }

        .form_area {
          padding: 2rem 1.5rem;
        }

        .title {
          font-size: 2rem;
        }
      }

      @media (max-width: 576px) {
        #main {
          padding: 1rem;
          align-items: flex-start;
          padding-top: 2rem;
        }

        .logo-container {
          display: block;
        }

        .container {
          max-width: 100%;
        }

        .form_area {
          padding: 1.8rem 1.2rem;
          border-radius: 16px;
        }

        .title {
          font-size: 1.8rem;
        }

        .sub_title {
          font-size: 1rem;
        }

        input.form_style {
          padding: 0.85rem 1rem 0.85rem 2.6rem;
        }

        .btn {
          padding: 0.9rem 0;
        }
      }

      @media (max-width: 400px) {
        .form_area {
          padding: 1.5rem 1rem;
        }

        .title {
          font-size: 1.6rem;
        }

        input.form_style {
          font-size: 0.95rem;
        }
      }

      /* Animation for form switching */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .container {
        animation: fadeIn 0.5s ease-out;
      }

      /* Loading spinner */
      .spinner {
        display: inline-block;
        width: 1rem;
        height: 1rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--white);
        animation: spin 0.8s linear infinite;
        margin-right: 0.5rem;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .loading {
        opacity: 0.7;
        cursor: wait;
      }
    </style>
  </head>

  <body>
    <div class="logo-container">
      <div class="logo">TWEET<span>NEPAL</span></div>
    </div>
    
    <div id="main">
      <!-- Sign Up Form -->
      <div class="container" id="signup">
        <div class="form_area">
          <p class="title"><i class="fas fa-user-plus"></i> Sign Up</p>
          <p class="sub_title">Create your Tweet Nepal account</p>
          <form
            action="/createUser"
            method="post"
            autocomplete="off"
            id="signupForm"
            onsubmit="return validateForm()"
          >
            <div class="form-group">
              <div class="input-container">
                <i class="fas fa-user input-icon"></i>
                <input
                  placeholder="Enter Your Full Name"
                  class="form_style"
                  type="text"
                  name="name"
                  id="name"
                  oninput="validateName()"
                  autocomplete="name"
                />
              </div>
              <span class="error-message hidden" id="nameError"></span>
            </div>

            <div class="form-group">
              <div class="input-container">
                <i class="fas fa-lock input-icon"></i>
                <input
                  placeholder="Enter Your Password"
                  id="password"
                  class="form_style"
                  name="password"
                  type="password"
                  oninput="validatePassword()"
                  autocomplete="new-password"
                />
                <button type="button" class="toggle-password" id="togglePassword">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="password-strength">
                <span>Strength:</span>
                <div class="strength-bar">
                  <div class="strength-fill" id="passwordStrength"></div>
                </div>
              </div>
              <span class="error-message hidden" id="passwordError"></span>
            </div>

            <div class="form-group">
              <div class="input-container">
                <i class="fas fa-at input-icon"></i>
                <input
                  placeholder="Enter Your Username"
                  class="form_style"
                  type="text"
                  name="username"
                  id="username"
                  onkeyup="checkUsernameAvailability()"
                  oninput="validateUsername()"
                  autocomplete="username"
                />
              </div>
              <p class="usernameAvailable" id="usernameMessage"></p>
              <span class="error-message hidden" id="usernameError"></span>
            </div>

            <button class="btn" id="submitButton" type="submit">
              <span id="submitText">Sign Up</span>
             
            </button>
          </form>
          
        </div>
      </div>

      <!-- Login Form -->
      <div class="container" id="login">
        <div class="form_area">
          <p class="title"><i class="fas fa-sign-in-alt"></i> Log In</p>
          <p class="sub_title">Welcome back! Please log in.</p>
          <form action="/login" method="post" autocomplete="off" id="loginForm">
            <div class="form-group">
              <div class="input-container">
                <i class="fas fa-user input-icon"></i>
                <input
                  placeholder="Enter your username"
                  class="form_style"
                  type="text"
                  name="username"
                  id="login-username"
                  autocomplete="username"
                />
              </div>
            </div>

            <div class="form-group">
              <div class="input-container">
                <i class="fas fa-lock input-icon"></i>
                <input
                  placeholder="Enter your password"
                  class="form_style"
                  type="password"
                  name="password"
                  id="login-password"
                  autocomplete="current-password"
                />
                <button type="button" class="toggle-password" id="toggleLoginPassword">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <button class="btn" type="submit" id="loginButton">
              <span id="loginText">Log In</span>
             
            </button>
          </form>
          
          
        </div>
      </div>
    </div>

    <script>
      // DOM Elements
      const signupForm = document.getElementById('signupForm');
      const loginForm = document.getElementById('loginForm');
      const togglePasswordBtn = document.getElementById('togglePassword');
      const toggleLoginPasswordBtn = document.getElementById('toggleLoginPassword');
      const passwordInput = document.getElementById('password');
      const loginPasswordInput = document.getElementById('login-password');
      const passwordStrength = document.getElementById('passwordStrength');
      const submitButton = document.getElementById('submitButton');
      const submitText = document.getElementById('submitText');
      const submitSpinner = document.getElementById('submitSpinner');
      const loginButton = document.getElementById('loginButton');
      const loginText = document.getElementById('loginText');
      const loginSpinner = document.getElementById('loginSpinner');

      // Toggle password visibility
      function togglePasswordVisibility(input, button) {
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);
        
        // Toggle icon
        const icon = button.querySelector('i');
        if (type === 'text') {
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        } else {
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        }
      }

      // Initialize toggle password buttons
      if (togglePasswordBtn) {
        togglePasswordBtn.addEventListener('click', () => {
          togglePasswordVisibility(passwordInput, togglePasswordBtn);
        });
      }

      if (toggleLoginPasswordBtn) {
        toggleLoginPasswordBtn.addEventListener('click', () => {
          togglePasswordVisibility(loginPasswordInput, toggleLoginPasswordBtn);
        });
      }

      // Show loading state
      function showLoading(button, textElement, spinnerElement) {
        button.disabled = true;
        button.classList.add('loading');
        textElement.classList.add('hidden');
        spinnerElement.classList.remove('hidden');
      }

      // Hide loading state
      function hideLoading(button, textElement, spinnerElement) {
        button.disabled = false;
        button.classList.remove('loading');
        textElement.classList.remove('hidden');
        spinnerElement.classList.add('hidden');
      }

      // Form submission handlers
      if (signupForm) {
        signupForm.addEventListener('submit', function(e) {
          if (validateForm()) {
            showLoading(submitButton, submitText, submitSpinner);
            // Form will be submitted normally after validation
          } else {
            e.preventDefault();
          }
        });
      }

      if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
          showLoading(loginButton, loginText, loginSpinner);
          // Form will be submitted normally
        });
      }

      // Check username availability
      let usernameCheckTimeout;
      async function checkUsernameAvailability() {
        const username = document.getElementById("username").value.trim();
        const messageElement = document.getElementById("usernameMessage");

        // Clear any previous timeout
        if (usernameCheckTimeout) {
          clearTimeout(usernameCheckTimeout);
        }

        // If username is empty, clear message and return
        if (!username) {
          messageElement.textContent = "";
          messageElement.className = "usernameAvailable";
          submitButton.disabled = true;
          return;
        }

        // If username doesn't meet basic validation, don't check
        if (!isValidUsername(username) || username.length < 3) {
          return;
        }

        // Set a timeout to avoid too many API calls
        usernameCheckTimeout = setTimeout(async () => {
          try {
            const response = await fetch("/checkUsername", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username }),
            });

            const data = await response.json();

            if (data.message === "Username already exists") {
              messageElement.textContent = data.message;
              messageElement.className = "usernameAvailable unavailable";
              submitButton.disabled = true;
            } else {
              messageElement.textContent = "Username is available";
              messageElement.className = "usernameAvailable available";
              submitButton.disabled = false;
            }
          } catch (error) {
            console.error("Error checking username availability:", error);
            messageElement.textContent = "Unable to check username availability";
            messageElement.className = "usernameAvailable unavailable";
          }
        }, 500); // Delay of 500ms
      }

      // Show error function
      function showError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const errorElement = document.getElementById(fieldId + "Error");

        if (field && errorElement) {
          field.classList.add("error");
          errorElement.textContent = message;
          errorElement.classList.remove("hidden");
        }
      }

      // Hide error function
      function hideError(fieldId) {
        const field = document.getElementById(fieldId);
        const errorElement = document.getElementById(fieldId + "Error");

        if (field && errorElement) {
          field.classList.remove("error");
          errorElement.classList.add("hidden");
        }
      }

      // Validate name
      function validateName() {
        const name = document.getElementById("name").value.trim();

        if (!name) {
          showError("name", "Name is required");
          return false;
        }

        if (name.length < 2) {
          showError("name", "Name must be at least 2 characters");
          return false;
        }

        if (!isValidProperName(name)) {
          showError(
            "name",
            "Name should contain only letters and spaces (2-30 characters, max 3 words)"
          );
          return false;
        }

        hideError("name");
        return true;
      }

      // Validate username
      function validateUsername() {
        const username = document.getElementById("username").value.trim();

        if (!username) {
          showError("username", "Username is required");
          return false;
        }

        if (username.length < 3) {
          showError("username", "Username must be at least 3 characters");
          return false;
        }

        if (username.length > 20) {
          showError("username", "Username must be less than 20 characters");
          return false;
        }

        if (!isValidUsername(username)) {
          showError(
            "username",
            "Username must start with a letter and contain only letters, numbers, and underscores"
          );
          return false;
        }

        hideError("username");
        return true;
      }

      // Check password strength
      function checkPasswordStrength(password) {
        let strength = 0;
        
        // Length check
        if (password.length >= 8) strength += 1;
        if (password.length >= 12) strength += 1;
        
        // Complexity checks
        if (/[a-z]/.test(password)) strength += 1;
        if (/[A-Z]/.test(password)) strength += 1;
        if (/[0-9]/.test(password)) strength += 1;
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        
        // Determine strength level
        if (strength <= 2) return 'weak';
        if (strength <= 4) return 'medium';
        return 'strong';
      }

      // Update password strength indicator
      function updatePasswordStrength(password) {
        const strength = checkPasswordStrength(password);
        passwordStrength.className = 'strength-fill ' + strength;
      }

      // Validate password
      function validatePassword() {
        const password = document.getElementById("password").value.trim();

        // Update strength indicator
        updatePasswordStrength(password);

        if (!password) {
          showError("password", "Password is required");
          return false;
        }

        if (password.length < 8) {
          showError("password", "Password must be at least 8 characters long");
          return false;
        }

        if (!isValidPassword(password)) {
          showError(
            "password",
            "Password must include uppercase, lowercase, and a digit"
          );
          return false;
        }

        hideError("password");
        return true;
      }

      // Validate entire form
      function validateForm() {
        const nameValid = validateName();
        const usernameValid = validateUsername();
        const passwordValid = validatePassword();

        if (!nameValid || !usernameValid || !passwordValid) {
          return false;
        }

        const usernameMessage = document.getElementById("usernameMessage");
        if (usernameMessage.textContent === "Username already exists") {
          return false;
        }

        return true;
      }

      // Validation functions
      function isValidProperName(name) {
        return /^[A-Za-z]{2,30}( [A-Za-z]{2,30}){0,2}$/.test(name);
      }

      function isValidUsername(username) {
        return /^[A-Za-z][A-Za-z0-9_]{2,19}$/.test(username);
      }

      function isValidPassword(password) {
        return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(password);
      }

      // Scroll to forms for mobile
      function scrollToLogin() {
        if (window.innerWidth <= 768) {
          document.getElementById('login').scrollIntoView({ behavior: 'smooth' });
        }
      }

      function scrollToSignup() {
        if (window.innerWidth <= 768) {
          document.getElementById('signup').scrollIntoView({ behavior: 'smooth' });
        }
      }

      // Add focus effects to inputs
      document.querySelectorAll('.form_style').forEach(input => {
        input.addEventListener('focus', function() {
          this.parentElement.querySelector('.input-icon').style.color = 'var(--primary)';
        });
        
        input.addEventListener('blur', function() {
          this.parentElement.querySelector('.input-icon').style.color = 'var(--grey-dark)';
        });
      });

      // Initialize password strength on page load
      document.addEventListener('DOMContentLoaded', function() {
        if (passwordInput.value) {
          updatePasswordStrength(passwordInput.value);
        }
      });
    </script>
  </body>
</html>